<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel | Sadri Villa</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#eef2ff}

/* ===== NAVBAR ===== */
.navbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 24px;background:#eaf2ff;
  box-shadow:0 4px 12px rgba(0,0,0,.08)
}
.nav-left h3{margin:0}

/* ===== TOP BAR ===== */
.admin-topbar{
  display:flex;
  gap:14px;
  padding:18px 24px;
  background:linear-gradient(180deg,#eef6ff,#f8fbff);
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  overflow-x:auto;
}
.admin-btn{
  padding:12px 22px;
  border-radius:999px;
  border:none;
  cursor:pointer;
  font-weight:600;
  font-size:14px;
  color:#fff;
  background:linear-gradient(135deg,#4facfe,#38bdf8);
}
.admin-btn.dark{background:linear-gradient(135deg,#3b82f6,#2563eb);}
.admin-btn.secondary{background:linear-gradient(135deg,#60a5fa,#93c5fd);}

/* ===== PAGE ===== */
.container{padding:20px}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px}
.controls select,.controls input,.controls button{
  padding:8px 12px;border-radius:10px;border:1px solid #c7d2fe
}
.success{background:#16a34a;color:#fff;border:none}
.secondary{background:#64748b;color:#fff;border:none}
.danger{background:#dc2626;color:#fff;border:none}

/* ===== TABLE ===== */
table{
  width:100%;border-collapse:collapse;background:#fff;
  border-radius:18px;overflow:hidden;
  box-shadow:0 18px 40px rgba(0,0,0,.1)
}
th,td{padding:12px;border-bottom:1px solid #e5e7eb;font-size:14px}
th{background:#f8fafc;text-align:left}

.badge{
  padding:4px 10px;border-radius:999px;
  color:#fff;font-size:12px
}
.green{background:#16a34a}
.yellow{background:#f59e0b}

.role-select{
  padding:6px 10px;
  border-radius:8px;
}

/* ===== PREMIUM MODAL ===== */
.modal-overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  backdrop-filter:blur(6px);
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:9999;
}

.modal-overlay.active{
  opacity:1;
  pointer-events:auto;
}

.modal-box{
  background:rgba(255,255,255,.9);
  backdrop-filter:blur(12px);
  padding:30px;
  border-radius:20px;
  width:320px;
  text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,.25);
  transform:scale(.8);
  transition:.3s;
}

.modal-overlay.active .modal-box{
  transform:scale(1);
}

.modal-buttons{
  margin-top:20px;
  display:flex;
  justify-content:center;
  gap:15px;
}

.modal-buttons button{
  padding:8px 16px;
  border:none;
  border-radius:999px;
  cursor:pointer;
  font-weight:600;
}

.btn-cancel{
  background:#64748b;
  color:#fff;
}

.btn-confirm{
  background:linear-gradient(135deg,#3b82f6,#2563eb);
  color:#fff;
}
</style>
</head>

<body>

<div class="navbar">
  <div class="nav-left">
    <h3>Sadri Villa ‚Äì Admin</h3>
  </div>
</div>

<div class="admin-topbar">
  <button class="admin-btn dark" onclick="location.href='admin-dashboard.html'">‚¨Ö Back</button>
  <button class="admin-btn" onclick="location.href='admin-profile.html'">üë§ Profile</button>
  <button class="admin-btn" onclick="location.href='admin-logo.html'">üè∑ Logo</button>
  <button class="admin-btn" onclick="location.href='admin-hero.html'">‚úè Hero</button>
  <button class="admin-btn" onclick="location.href='admin-slider.html'">üß© Slider</button>
  <button class="admin-btn secondary" onclick="location.href='add-admin.html'">‚ûï Add Admin</button>
</div>

<div class="container">

<div class="controls">
  <select id="statusFilter" onchange="render()">
    <option value="all">All Users</option>
    <option value="approved">Approved</option>
    <option value="pending">Pending</option>
    <option value="admin">Admins Only</option>
    <option value="user">Users Only</option>
  </select>

  <input id="search" placeholder="Search..." oninput="render()">
</div>

<table>
<thead>
<tr>
  <th><input type="checkbox" onclick="toggleAll(this)"></th>
  <th>#</th>
  <th>Name</th>
  <th>Email</th>
  <th>Role</th>
  <th>Created</th>
  <th>Status</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

</div>

<!-- PREMIUM MODAL -->
<div class="modal-overlay" id="modal">
  <div class="modal-box">
    <h3 id="modalText">Confirm Action</h3>
    <div class="modal-buttons">
      <button class="btn-cancel" onclick="closeModal()">Cancel</button>
      <button class="btn-confirm" onclick="confirmAction()">Confirm</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import {
  getFirestore,
  collection,
  getDocs,
  doc,
  getDoc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyC7gkT4F_dRJpWfef12y6cwV3F2PTMJ6fY",
  authDomain:"sadri-villa-14c06.firebaseapp.com",
  projectId:"sadri-villa-14c06"
});

const auth=getAuth();
const db=getFirestore();

let users=[];
let pendingRoleChange=null;

onAuthStateChanged(auth, async user=>{
  if(!user){ location.href="login.html"; return; }
  const snap=await getDoc(doc(db,"users",user.uid));
  if(!snap.exists()||snap.data().role!=="admin"){
    location.href="dashboard.html";
    return;
  }
  load();
});

async function load(){
  users=[];
  const snap=await getDocs(collection(db,"users"));
  snap.forEach(d=>users.push({uid:d.id,...d.data()}));
  users.sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
  render();
}

function formatDate(v){
  if(!v||!v.seconds)return "-";
  return new Date(v.seconds*1000).toLocaleDateString("en-IN");
}

window.render=()=>{
  const tbody=document.getElementById("tbody");
  const q=document.getElementById("search").value.toLowerCase();
  const filter=document.getElementById("statusFilter").value;

  tbody.innerHTML="";

  let filtered=users.filter(u=>{
    if(filter==="admin"&&u.role!=="admin")return false;
    if(filter==="user"&&u.role==="admin")return false;
    if(filter==="approved"&&!u.approved)return false;
    if(filter==="pending"&&u.approved)return false;
    return (u.fullName||"").toLowerCase().includes(q)
        || (u.email||"").toLowerCase().includes(q);
  });

  filtered.forEach((u,i)=>{
    tbody.innerHTML+=`
    <tr>
      <td><input type="checkbox"></td>
      <td>${i+1}</td>
      <td>${u.fullName||"-"}</td>
      <td>${u.email||"-"}</td>
      <td>
        <select class="role-select"
          onchange="openRoleModal('${u.uid}','${u.role}',this)">
          <option value="user" ${u.role!=="admin"?"selected":""}>User</option>
          <option value="admin" ${u.role==="admin"?"selected":""}>Admin</option>
        </select>
      </td>
      <td>${formatDate(u.createdAt)}</td>
      <td><span class="badge ${u.approved?"green":"yellow"}">
        ${u.approved?"Approved":"Pending"}
      </span></td>
    </tr>`;
  });
};

/* ===== PREMIUM MODAL LOGIC ===== */
window.openRoleModal=(uid,oldRole,selectEl)=>{
  const newRole=selectEl.value;
  if(newRole===oldRole)return;

  pendingRoleChange={uid,oldRole,newRole,selectEl};
  document.getElementById("modalText").innerText=
    `Change role to ${newRole.toUpperCase()} ?`;
  document.getElementById("modal").classList.add("active");
};

window.closeModal=()=>{
  if(pendingRoleChange){
    pendingRoleChange.selectEl.value=pendingRoleChange.oldRole;
  }
  pendingRoleChange=null;
  document.getElementById("modal").classList.remove("active");
};

window.confirmAction=async()=>{
  if(!pendingRoleChange)return;

  await updateDoc(doc(db,"users",pendingRoleChange.uid),
    {role:pendingRoleChange.newRole});

  pendingRoleChange=null;
  document.getElementById("modal").classList.remove("active");
  load();
};
</script>

</body>
</html>
