<!DOCTYPE html>
<html>
<head>
<title>Admin Logs</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:Arial;background:#eef2ff;padding:20px}
div{background:#fff;padding:12px;margin-bottom:8px;border-radius:12px}
</style>
</head>
<body>

<h2>üîç Admin Audit Logs</h2>
<div id="logs"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore,collection,getDocs,orderBy,query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app=initializeApp({
  apiKey:"AIzaSyC7gkT4F_dRJpWfef12y6cwV3F2PTMJ6fY",
  authDomain:"sadri-villa-14c06.firebaseapp.com",
  projectId:"sadri-villa-14c06"
});
const auth=getAuth(app);
const db=getFirestore(app);
const logs=document.getElementById("logs");

onAuthStateChanged(auth,async user=>{
  if(!user) location.href="login.html";
  const t=await user.getIdTokenResult();
  if(!t.claims.admin) location.href="dashboard.html";

  const q=query(collection(db,"adminLogs"),orderBy("at","desc"));
  const snap=await getDocs(q);
  snap.forEach(d=>{
    const x=d.data();
    logs.innerHTML+=`
      <div>
        <b>${x.action}</b><br>
        Target: ${x.targetUid}<br>
        By: ${x.by}<br>
        ${new Date(x.at).toLocaleString()}
      </div>`;
  });
});
</script>

</body>
</html>
