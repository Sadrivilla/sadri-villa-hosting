<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Change Password</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:Arial, sans-serif;
  background:#eef2ff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  margin:0;
}

.card{
  background:#fff;
  padding:32px;
  border-radius:22px;
  width:100%;
  max-width:420px;
  box-shadow:0 20px 45px rgba(0,0,0,.15);
}

h2{
  text-align:center;
  margin-bottom:26px;
  font-size:22px;
}

/* ===== Floating Field ===== */
.field{
  position:relative;
  margin:18px 0;
}

.field input{
  width:100%;
  height:56px;
  padding:18px 52px 0 16px;
  border-radius:14px;
  border:1.5px solid #d1d5db;
  font-size:15px;
  outline:none;
  box-sizing:border-box;
  transition:border-color .25s, box-shadow .25s;
}

.field label{
  position:absolute;
  left:16px;
  top:50%;
  transform:translateY(-50%);
  font-size:14px;
  color:#6b7280;
  pointer-events:none;
  transition:.25s ease;
  background:#fff;
  padding:0 6px;
}

/* Floating effect */
.field input:focus + label,
.field input:not(:placeholder-shown) + label{
  top:6px;
  font-size:12px;
  color:#6d28d9;
}

/* Eye toggle */
.toggle{
  position:absolute;
  right:16px;
  top:50%;
  transform:translateY(-50%);
  font-size:20px;
  cursor:pointer;
  transition:transform .25s ease, color .25s ease;
}

.toggle.active{
  transform:translateY(-50%) rotate(180deg) scale(1.15);
  color:#6d28d9;
}

/* ===== Strength ===== */
.strength{
  font-size:13px;
  margin-top:-8px;
  margin-bottom:8px;
}

.weak{color:#ef4444}
.medium{color:#f59e0b}
.strong{color:#16a34a}

/* ===== Errors ===== */
.field.error input{
  border-color:#ef4444;
  animation:shake .35s;
}

@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-4px)}
  50%{transform:translateX(4px)}
  75%{transform:translateX(-4px)}
  100%{transform:translateX(0)}
}

/* ===== Button ===== */
button{
  width:100%;
  height:56px;
  margin-top:12px;
  border:none;
  border-radius:16px;
  background:#6d28d9;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}

/* ===== Message ===== */
.msg{
  margin-top:14px;
  text-align:center;
  font-size:14px;
}
.msg.error{color:red}
.msg.success{color:green}
</style>
</head>

<body>

<div class="card">
  <h2>üîë Change Password</h2>

  <div class="field" id="newField">
    <input type="password" id="newPassword" placeholder=" " oninput="checkStrength()">
    <label>New Password</label>
    <span class="toggle" onclick="togglePassword('newPassword', this)">üëÅ</span>
  </div>
  <div class="strength" id="strengthText"></div>

  <div class="field" id="confirmField">
    <input type="password" id="confirmPassword" placeholder=" ">
    <label>Confirm Password</label>
    <span class="toggle" onclick="togglePassword('confirmPassword', this)">üëÅ</span>
  </div>

  <button onclick="changePassword()">Update Password</button>

  <div class="msg" id="msg"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, updatePassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

/* üî• FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyC7gkT4F_dRJpWfef12y6cwV3F2PTMJ6fY",
  authDomain: "sadri-villa-14c06.firebaseapp.com",
  projectId: "sadri-villa-14c06"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

/* üîí Auth guard */
onAuthStateChanged(auth, (user)=>{
  if(!user){
    location.href = "login.html";
  }
});

/* üëÅ Toggle */
window.togglePassword = function(id, el){
  const input = document.getElementById(id);
  if(input.type === "password"){
    input.type = "text";
    el.innerText = "üôà";
    el.classList.add("active");
  }else{
    input.type = "password";
    el.innerText = "üëÅ";
    el.classList.remove("active");
  }
};

/* üîê Strength */
window.checkStrength = function(){
  const val = newPassword.value;
  const s = document.getElementById("strengthText");

  if(val.length < 6){
    s.textContent = "Weak password";
    s.className = "strength weak";
  }else if(/[A-Z]/.test(val) && /\d/.test(val)){
    s.textContent = "Strong password";
    s.className = "strength strong";
  }else{
    s.textContent = "Medium password";
    s.className = "strength medium";
  }
};

/* ‚ùå Shake + red border */
function showMismatch(){
  newField.classList.add("error");
  confirmField.classList.add("error");
  setTimeout(()=>{
    newField.classList.remove("error");
    confirmField.classList.remove("error");
  },400);
}

/* üîë Change password */
window.changePassword = async function(){
  const newPass = newPassword.value;
  const confirmPass = confirmPassword.value;
  const msg = document.getElementById("msg");

  msg.textContent = "";
  msg.className = "msg";

  if(newPass.length < 6){
    msg.textContent = "Password must be at least 6 characters";
    msg.classList.add("error");
    return;
  }

  if(newPass !== confirmPass){
    msg.textContent = "Passwords do not match";
    msg.classList.add("error");
    showMismatch();
    return;
  }

  try{
    await updatePassword(auth.currentUser, newPass);
    msg.textContent = "Password updated successfully";
    msg.classList.add("success");

    setTimeout(()=>{
      location.href = "dashboard.html";
    },2000);

  }catch(error){
    msg.textContent =
      error.code === "auth/requires-recent-login"
      ? "Please login again to change password"
      : error.message;
    msg.classList.add("error");
  }
};
</script>

</body>
</html>
