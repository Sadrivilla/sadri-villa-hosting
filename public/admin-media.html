<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Media | Sadri Villa</title>

<!-- Firebase compat (stable for admin tools) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f8fafc;padding:30px}
.card{background:#fff;padding:20px;border-radius:14px;max-width:520px;margin-bottom:22px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
button{padding:10px 16px;border-radius:10px;border:none;background:#2563eb;color:#fff;cursor:pointer}
small{color:#64748b}
.preview{margin-top:10px}
.preview img{max-width:100%;border-radius:12px}
.back{background:#64748b;margin-bottom:20px}
</style>
</head>

<body>

<button class="back" onclick="history.back()">‚Üê Back</button>

<h2>Admin Media Upload ‚Äì Sadri Villa</h2>

<div class="card">
  <h3>Upload Logo</h3>
  <small>PNG | 300 √ó 80 px</small><br><br>
  <input type="file" id="logo" accept="image/*">
  <button onclick="uploadSingle('logo',300,80)">Upload Logo</button>
  <div class="preview" id="logoPrev"></div>
</div>

<div class="card">
  <h3>Upload Hero Image</h3>
  <small>JPG | 1920 √ó 1080 px</small><br><br>
  <input type="file" id="hero" accept="image/*">
  <button onclick="uploadSingle('hero',1920,1080)">Upload Hero</button>
  <div class="preview" id="heroPrev"></div>
</div>

<div class="card">
  <h3>Upload Slider Images</h3>
  <small>Multiple images | 1600 √ó 900 px</small><br><br>
  <input type="file" id="slider" multiple accept="image/*">
  <button onclick="uploadSlider()">Upload Slider Images</button>
</div>

<script>
/* üî• FIREBASE CONFIG ‚Äî REQUIRED */
firebase.initializeApp({
  apiKey: "AIzaSyC7gkT4F_dRJpWfef12y6cwV3F2PTMJ6fY",
  authDomain: "sadri-villa-14c06.firebaseapp.com",
  projectId: "sadri-villa-14c06",
  storageBucket: "sadri-villa-14c06.appspot.com"
});

const auth = firebase.auth();
const storage = firebase.storage();
const db = firebase.firestore();

/* AUTH GUARD */
auth.onAuthStateChanged(user=>{
  if(!user){
    alert("Login required");
    location.href="login.html";
  }
});

/* IMAGE RESIZE */
function resizeImage(file,w,h){
  return new Promise(res=>{
    const img=new Image();
    img.onload=()=>{
      const c=document.createElement("canvas");
      c.width=w;c.height=h;
      c.getContext("2d").drawImage(img,0,0,w,h);
      c.toBlob(b=>res(b),"image/jpeg",0.85);
    };
    img.src=URL.createObjectURL(file);
  });
}

/* SINGLE UPLOAD */
async function uploadSingle(type,w,h){
  const file=document.getElementById(type).files[0];
  if(!file) return alert("Select image");

  const blob=await resizeImage(file,w,h);
  const ref=storage.ref(`images/site/${type}.jpg`);
  await ref.put(blob);
  const url=await ref.getDownloadURL();

  await db.collection("siteSettings").doc("home").set({
    [type]:{url, width:w, height:h, alt:`Sadri Villa ${type}`}
  },{merge:true});

  document.getElementById(type+"Prev").innerHTML=`<img src="${url}">`;
  alert(type+" uploaded");
}

/* SLIDER UPLOAD */
async function uploadSlider(){
  const files=[...document.getElementById("slider").files];
  if(!files.length) return alert("Select images");

  const ref=db.collection("siteSettings").doc("home");

  for(const f of files){
    const blob=await resizeImage(f,1600,900);
    const path=`images/site/slider/${Date.now()}-${f.name}`;
    const sref=storage.ref(path);
    await sref.put(blob);
    const url=await sref.getDownloadURL();

    await ref.set({
      sliderImages:firebase.firestore.FieldValue.arrayUnion({
        url, width:1600, height:900,
        alt:"Sadri Villa Gallery",
        order:Date.now()
      })
    },{merge:true});
  }
  alert("Slider images uploaded");
}
</script>

</body>
</html>
