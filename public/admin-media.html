<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Media Manager – Sadri Villa</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{
  font-family:Arial;
  background:#f3f6f9;
  padding:30px
}
.card{
  background:#fff;
  padding:22px;
  border-radius:18px;
  max-width:800px;
  box-shadow:0 12px 30px rgba(0,0,0,.08)
}
button{
  padding:10px 18px;
  border:none;
  border-radius:10px;
  background:#2563eb;
  color:#fff;
  font-weight:600;
  cursor:pointer
}
.msg{
  margin-top:10px;
  font-size:14px
}
.msg.error{color:#991b1b}
.msg.success{color:#065f46}
.msg.loading{color:#1d4ed8}
</style>
</head>

<body>

<h2>Admin Media Manager – Sadri Villa</h2>

<div class="card">
  <h3>Logo</h3>
  <input type="file" id="logoInput" accept="image/*">
  <br><br>
  <button onclick="uploadLogo()">Upload Logo</button>
  <div class="msg" id="logoMsg"></div>
</div>

<script>
/* ================= FIREBASE INIT ================= */
firebase.initializeApp({
  apiKey: "AIzaSyC7gkT4F_dRJpWfef12y6cwV3F2PTMJ6fY",
  authDomain: "sadri-villa-14c06.firebaseapp.com",
  projectId: "sadri-villa-14c06"
});

/* ================= AUTH CHECK ================= */
let authReady = false;

firebase.auth().onAuthStateChanged(user => {
  if (!user) {
    alert("Admin login required");
    location.href = "/login.html";
    return;
  }
  console.log("✅ Admin session restored:", user.uid);
  authReady = true;
});

/* ================= UPLOAD LOGO ================= */
async function uploadLogo() {
  const msg = document.getElementById("logoMsg");
  const file = document.getElementById("logoInput").files[0];

  if (!authReady) {
    msg.className = "msg error";
    msg.innerText = "Please wait… admin session loading";
    return;
  }

  if (!file) {
    msg.className = "msg error";
    msg.innerText = "Please select a logo first";
    return;
  }

  msg.className = "msg loading";
  msg.innerText = "Uploading logo…";

  try {
    const user = firebase.auth().currentUser;
    const token = await user.getIdToken(true);

    const formData = new FormData();
    formData.append("logo", file);

    const res = await fetch(
      "https://uploadsiteimage-jgzkr3mifq-uc.a.run.app",
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${token}`
        },
        body: formData
      }
    );

    if (!res.ok) {
      const err = await res.text();
      throw new Error(err);
    }

    msg.className = "msg success";
    msg.innerText = "Logo uploaded successfully ✅";

  } catch (err) {
    console.error(err);
    msg.className = "msg error";
    msg.innerText = "Upload failed";
  }
}
</script>

</body>
</html>
